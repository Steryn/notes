# ÂÆπÂô®ÂåñÈÉ®ÁΩ≤

## üìñ Ê¶ÇËø∞

ÂÆπÂô®ÂåñÊòØÁé∞‰ª£Â∫îÁî®ÈÉ®ÁΩ≤ÁöÑÊ†áÂáÜÊñπÂºèÔºåÈÄöËøáÂ∞ÜÂ∫îÁî®Á®ãÂ∫èÂèäÂÖ∂‰æùËµñÈ°πÊâìÂåÖÂà∞ËΩªÈáèÁ∫ß„ÄÅÂèØÁßªÊ§çÁöÑÂÆπÂô®‰∏≠ÔºåÂÆûÁé∞‰∏ÄËá¥ÁöÑËøêË°åÁéØÂ¢É„ÄÇDocker ÊòØÊúÄÊµÅË°åÁöÑÂÆπÂô®ÂåñÂπ≥Âè∞Ôºå‰∏∫ Node.js Â∫îÁî®Êèê‰æõ‰∫ÜÂÆåÊï¥ÁöÑÂÆπÂô®ÂåñËß£ÂÜ≥ÊñπÊ°à„ÄÇ

## üéØ Â≠¶‰π†ÁõÆÊ†á

- ÊéåÊè° Docker ÂÆπÂô®ÂåñÂü∫Á°Ä
- Â≠¶‰π† Node.js Â∫îÁî®ÂÆπÂô®ÂåñÊúÄ‰Ω≥ÂÆûË∑µ
- ‰∫ÜËß£Â§öÈò∂ÊÆµÊûÑÂª∫Âíå‰ºòÂåñÊäÄÂ∑ß
- ÊéåÊè°ÂÆπÂô®ÁºñÊéíÂíåÈÉ®ÁΩ≤Á≠ñÁï•

## üöÄ Docker Âü∫Á°Ä

### 1. Âü∫Êú¨ Dockerfile

```dockerfile
# Âü∫Á°ÄÈïúÂÉè
FROM node:18-alpine

# ËÆæÁΩÆÂ∑•‰ΩúÁõÆÂΩï
WORKDIR /app

# Â§çÂà∂ package Êñá‰ª∂
COPY package*.json ./

# ÂÆâË£Ö‰æùËµñ
RUN npm ci --only=production && npm cache clean --force

# Â§çÂà∂Â∫îÁî®‰ª£Á†Å
COPY . .

# ÂàõÂª∫Èùû root Áî®Êà∑
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# Êõ¥ÊîπÊñá‰ª∂ÊâÄÊúâËÄÖ
RUN chown -R nextjs:nodejs /app
USER nextjs

# Êö¥Èú≤Á´ØÂè£
EXPOSE 3000

# ÂÅ•Â∫∑Ê£ÄÊü•
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node healthcheck.js

# ÂêØÂä®ÂëΩ‰ª§
CMD ["node", "server.js"]
```

### 2. Â§öÈò∂ÊÆµÊûÑÂª∫

```dockerfile
# Â§öÈò∂ÊÆµÊûÑÂª∫ - ÊûÑÂª∫Èò∂ÊÆµ
FROM node:18-alpine AS builder

WORKDIR /app

# Â§çÂà∂ package Êñá‰ª∂
COPY package*.json ./

# ÂÆâË£ÖÊâÄÊúâ‰æùËµñÔºàÂåÖÊã¨ÂºÄÂèë‰æùËµñÔºâ
RUN npm ci

# Â§çÂà∂Ê∫ê‰ª£Á†Å
COPY . .

# ÊûÑÂª∫Â∫îÁî®
RUN npm run build

# ËøêË°åÊµãËØï
RUN npm test

# Áîü‰∫ßÈò∂ÊÆµ
FROM node:18-alpine AS production

WORKDIR /app

# Â§çÂà∂ package Êñá‰ª∂
COPY package*.json ./

# Âè™ÂÆâË£ÖÁîü‰∫ß‰æùËµñ
RUN npm ci --only=production && npm cache clean --force

# ‰ªéÊûÑÂª∫Èò∂ÊÆµÂ§çÂà∂ÊûÑÂª∫ÁªìÊûú
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/public ./public

# Â§çÂà∂ÂøÖË¶ÅÁöÑÈÖçÁΩÆÊñá‰ª∂
COPY --from=builder /app/config ./config

# ÂàõÂª∫Áî®Êà∑
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001

# Êõ¥ÊîπÊâÄÊúâËÄÖ
RUN chown -R nextjs:nodejs /app
USER nextjs

EXPOSE 3000

HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:3000/health || exit 1

CMD ["node", "dist/server.js"]
```

### 3. ‰ºòÂåñÁöÑ Dockerfile

```dockerfile
# ‰ΩøÁî®ÁâπÂÆöÁâàÊú¨ÁöÑ Alpine ÈïúÂÉè
FROM node:18.17.0-alpine3.18

# ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè
ENV NODE_ENV=production
ENV NPM_CONFIG_LOGLEVEL=warn
ENV NPM_CONFIG_COLOR=false

# ÂÆâË£ÖÁ≥ªÁªü‰æùËµñ
RUN apk add --no-cache \
    dumb-init \
    curl \
    && rm -rf /var/cache/apk/*

# ÂàõÂª∫Â∫îÁî®ÁõÆÂΩï
WORKDIR /app

# ÂàõÂª∫Áî®Êà∑ÂíåÁªÑ
RUN addgroup -g 1001 -S nodejs && \
    adduser -S -D -H -u 1001 -s /sbin/nologin nodejs

# Â§çÂà∂ package Êñá‰ª∂Âπ∂ÂÆâË£Ö‰æùËµñ
COPY --chown=nodejs:nodejs package*.json ./
RUN npm ci --only=production --silent && \
    npm cache clean --force --silent

# Â§çÂà∂Â∫îÁî®‰ª£Á†Å
COPY --chown=nodejs:nodejs . .

# ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊùÉÈôê
RUN chmod -R 755 /app

# ÂàáÊç¢Âà∞Èùû root Áî®Êà∑
USER nodejs

# Êö¥Èú≤Á´ØÂè£
EXPOSE 3000

# ÂÅ•Â∫∑Ê£ÄÊü•
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

# ‰ΩøÁî® dumb-init ‰Ωú‰∏∫ PID 1
ENTRYPOINT ["dumb-init", "--"]

# ÂêØÂä®Â∫îÁî®
CMD ["node", "server.js"]
```

## üîß Â∫îÁî®ÈÖçÁΩÆ

### 1. ÁéØÂ¢ÉÂèòÈáèÁÆ°ÁêÜ

```javascript
// config/index.js
const config = {
  // ÊúçÂä°Âô®ÈÖçÁΩÆ
  server: {
    port: parseInt(process.env.PORT) || 3000,
    host: process.env.HOST || '0.0.0.0',
    env: process.env.NODE_ENV || 'development'
  },
  
  // Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ
  database: {
    host: process.env.DB_HOST || 'localhost',
    port: parseInt(process.env.DB_PORT) || 5432,
    name: process.env.DB_NAME || 'myapp',
    user: process.env.DB_USER || 'user',
    password: process.env.DB_PASSWORD || 'password',
    ssl: process.env.DB_SSL === 'true'
  },
  
  // Redis ÈÖçÁΩÆ
  redis: {
    host: process.env.REDIS_HOST || 'localhost',
    port: parseInt(process.env.REDIS_PORT) || 6379,
    password: process.env.REDIS_PASSWORD || '',
    db: parseInt(process.env.REDIS_DB) || 0
  },
  
  // Êó•ÂøóÈÖçÁΩÆ
  logging: {
    level: process.env.LOG_LEVEL || 'info',
    format: process.env.LOG_FORMAT || 'json'
  },
  
  // ÂÆâÂÖ®ÈÖçÁΩÆ
  security: {
    jwtSecret: process.env.JWT_SECRET || 'default-secret',
    corsOrigins: process.env.CORS_ORIGINS ? 
      process.env.CORS_ORIGINS.split(',') : ['http://localhost:3000']
  }
};

// È™åËØÅÂøÖÈúÄÁöÑÁéØÂ¢ÉÂèòÈáè
const requiredEnvVars = [
  'DB_HOST',
  'DB_USER', 
  'DB_PASSWORD',
  'JWT_SECRET'
];

const missingVars = requiredEnvVars.filter(varName => !process.env[varName]);

if (missingVars.length > 0) {
  console.error('Áº∫Â∞ëÂøÖÈúÄÁöÑÁéØÂ¢ÉÂèòÈáè:', missingVars.join(', '));
  process.exit(1);
}

module.exports = config;
```

### 2. ÂÅ•Â∫∑Ê£ÄÊü•Á´ØÁÇπ

```javascript
// healthcheck.js
const http = require('http');

const options = {
  host: 'localhost',
  port: process.env.PORT || 3000,
  path: '/health',
  timeout: 2000
};

const request = http.request(options, (res) => {
  console.log(`ÂÅ•Â∫∑Ê£ÄÊü•Áä∂ÊÄÅ: ${res.statusCode}`);
  if (res.statusCode === 200) {
    process.exit(0);
  } else {
    process.exit(1);
  }
});

request.on('error', (err) => {
  console.error('ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•:', err.message);
  process.exit(1);
});

request.end();

// server.js ‰∏≠ÁöÑÂÅ•Â∫∑Ê£ÄÊü•Ë∑ØÁî±
app.get('/health', async (req, res) => {
  const health = {
    status: 'UP',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    memory: process.memoryUsage(),
    pid: process.pid,
    version: process.env.npm_package_version || '1.0.0'
  };
  
  try {
    // Ê£ÄÊü•Êï∞ÊçÆÂ∫ìËøûÊé•
    await checkDatabase();
    health.database = 'UP';
    
    // Ê£ÄÊü• Redis ËøûÊé•
    await checkRedis();
    health.redis = 'UP';
    
    res.status(200).json(health);
  } catch (error) {
    health.status = 'DOWN';
    health.error = error.message;
    res.status(503).json(health);
  }
});

async function checkDatabase() {
  // Êï∞ÊçÆÂ∫ìÂÅ•Â∫∑Ê£ÄÊü•ÈÄªËæë
  return new Promise((resolve, reject) => {
    // ÊâßË°åÁÆÄÂçïÊü•ËØ¢
    db.query('SELECT 1', (err, result) => {
      if (err) reject(err);
      else resolve(result);
    });
  });
}

async function checkRedis() {
  // Redis ÂÅ•Â∫∑Ê£ÄÊü•ÈÄªËæë
  return new Promise((resolve, reject) => {
    redis.ping((err, result) => {
      if (err) reject(err);
      else resolve(result);
    });
  });
}
```

### 3. ‰ºòÈõÖÂÖ≥Èó≠

```javascript
// server.js
const express = require('express');
const app = express();

let server;
let isShuttingDown = false;

// ÂêØÂä®ÊúçÂä°Âô®
function startServer() {
  server = app.listen(config.server.port, config.server.host, () => {
    console.log(`ÊúçÂä°Âô®ËøêË°åÂú® ${config.server.host}:${config.server.port}`);
  });
  
  // ËÆæÁΩÆÊúçÂä°Âô®Ë∂ÖÊó∂
  server.timeout = 30000; // 30 Áßí
  server.keepAliveTimeout = 65000; // 65 Áßí
  server.headersTimeout = 66000; // 66 Áßí
}

// ‰ºòÈõÖÂÖ≥Èó≠Â§ÑÁêÜ
function gracefulShutdown(signal) {
  console.log(`Êî∂Âà∞ ${signal} ‰ø°Âè∑ÔºåÂºÄÂßã‰ºòÈõÖÂÖ≥Èó≠...`);
  
  if (isShuttingDown) {
    console.log('Â∑≤ÁªèÂú®ÂÖ≥Èó≠ËøáÁ®ã‰∏≠...');
    return;
  }
  
  isShuttingDown = true;
  
  // ÂÅúÊ≠¢Êé•ÂèóÊñ∞ËøûÊé•
  server.close((err) => {
    if (err) {
      console.error('ÂÖ≥Èó≠ÊúçÂä°Âô®Êó∂Âá∫Èîô:', err);
      process.exit(1);
    }
    
    console.log('HTTP ÊúçÂä°Âô®Â∑≤ÂÖ≥Èó≠');
    
    // ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•
    if (db) {
      db.end(() => {
        console.log('Êï∞ÊçÆÂ∫ìËøûÊé•Â∑≤ÂÖ≥Èó≠');
      });
    }
    
    // ÂÖ≥Èó≠ Redis ËøûÊé•
    if (redis) {
      redis.quit(() => {
        console.log('Redis ËøûÊé•Â∑≤ÂÖ≥Èó≠');
      });
    }
    
    console.log('‰ºòÈõÖÂÖ≥Èó≠ÂÆåÊàê');
    process.exit(0);
  });
  
  // Âº∫Âà∂ÂÖ≥Èó≠Ë∂ÖÊó∂
  setTimeout(() => {
    console.error('Âº∫Âà∂ÂÖ≥Èó≠Ë∂ÖÊó∂ÔºåÁ´ãÂç≥ÈÄÄÂá∫');
    process.exit(1);
  }, 30000);
}

// Ê≥®ÂÜå‰ø°Âè∑Â§ÑÁêÜ
process.on('SIGTERM', () => gracefulShutdown('SIGTERM'));
process.on('SIGINT', () => gracefulShutdown('SIGINT'));

// Â§ÑÁêÜÊú™ÊçïËé∑ÁöÑÂºÇÂ∏∏
process.on('uncaughtException', (err) => {
  console.error('Êú™ÊçïËé∑ÁöÑÂºÇÂ∏∏:', err);
  gracefulShutdown('uncaughtException');
});

process.on('unhandledRejection', (reason, promise) => {
  console.error('Êú™Â§ÑÁêÜÁöÑ Promise ÊãíÁªù:', reason);
  gracefulShutdown('unhandledRejection');
});

startServer();
```

## üê≥ Docker Compose

### 1. Âü∫Êú¨ Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=postgres
      - REDIS_HOST=redis
      - JWT_SECRET=your-jwt-secret
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    restart: unless-stopped
    networks:
      - app-network
    volumes:
      - ./logs:/app/logs
    healthcheck:
      test: ["CMD", "node", "healthcheck.js"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=myapp
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - app-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d myapp"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes --requirepass password
    volumes:
      - redis-data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - app
    restart: unless-stopped
    networks:
      - app-network

volumes:
  postgres-data:
  redis-data:

networks:
  app-network:
    driver: bridge
```

### 2. ÂºÄÂèëÁéØÂ¢ÉÈÖçÁΩÆ

```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
      - "9229:9229"  # Node.js Ë∞ÉËØïÁ´ØÂè£
    environment:
      - NODE_ENV=development
      - DB_HOST=postgres
      - REDIS_HOST=redis
    volumes:
      - .:/app
      - /app/node_modules
    command: npm run dev
    depends_on:
      - postgres
      - redis
    networks:
      - app-network

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=myapp_dev
      - POSTGRES_USER=dev_user
      - POSTGRES_PASSWORD=dev_password
    volumes:
      - postgres-dev-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - app-network

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    networks:
      - app-network

  adminer:
    image: adminer
    ports:
      - "8080:8080"
    depends_on:
      - postgres
    networks:
      - app-network

volumes:
  postgres-dev-data:

networks:
  app-network:
    driver: bridge
```

### 3. ÂºÄÂèëÁî® Dockerfile

```dockerfile
# Dockerfile.dev
FROM node:18-alpine

WORKDIR /app

# ÂÆâË£ÖÂºÄÂèëÂ∑•ÂÖ∑
RUN apk add --no-cache git

# Â§çÂà∂ package Êñá‰ª∂
COPY package*.json ./

# ÂÆâË£ÖÊâÄÊúâ‰æùËµñ
RUN npm install

# Â§çÂà∂Ê∫ê‰ª£Á†Å
COPY . .

# Êö¥Èú≤Á´ØÂè£
EXPOSE 3000 9229

# ÂºÄÂèëÊ®°ÂºèÂêØÂä®
CMD ["npm", "run", "dev"]
```

## üîÑ CI/CD ÈõÜÊàê

### 1. GitHub Actions

```yaml
# .github/workflows/docker.yml
name: Docker Build and Deploy

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test
          POSTGRES_DB: test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432
      
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 3s
          --health-retries 5
        ports:
          - 6379:6379
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run linting
      run: npm run lint
    
    - name: Run tests
      run: npm test
      env:
        DB_HOST: localhost
        DB_PORT: 5432
        DB_NAME: test
        DB_USER: postgres
        DB_PASSWORD: test
        REDIS_HOST: localhost
        REDIS_PORT: 6379

  build:
    needs: test
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Log in to Container Registry
      uses: docker/login-action@v2
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Extract metadata
      id: meta
      uses: docker/metadata-action@v4
      with:
        images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
        tags: |
          type=ref,event=branch
          type=ref,event=pr
          type=sha,prefix={{branch}}-
    
    - name: Build and push Docker image
      uses: docker/build-push-action@v4
      with:
        context: .
        push: true
        tags: ${{ steps.meta.outputs.tags }}
        labels: ${{ steps.meta.outputs.labels }}
        cache-from: type=gha
        cache-to: type=gha,mode=max

  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Deploy to production
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /opt/myapp
          docker-compose pull
          docker-compose up -d
          docker system prune -f
```

### 2. ÈÉ®ÁΩ≤ËÑöÊú¨

```bash
#!/bin/bash
# deploy.sh

set -e

# ÈÖçÁΩÆÂèòÈáè
IMAGE_NAME="myapp"
CONTAINER_NAME="myapp-container"
PORT="3000"

echo "ÂºÄÂßãÈÉ®ÁΩ≤Â∫îÁî®..."

# ÊûÑÂª∫Êñ∞ÈïúÂÉè
echo "ÊûÑÂª∫ Docker ÈïúÂÉè..."
docker build -t $IMAGE_NAME:latest .

# ÂÅúÊ≠¢Âπ∂ÁßªÈô§ÊóßÂÆπÂô®
echo "ÂÅúÊ≠¢ÊóßÂÆπÂô®..."
docker stop $CONTAINER_NAME 2>/dev/null || true
docker rm $CONTAINER_NAME 2>/dev/null || true

# ËøêË°åÊñ∞ÂÆπÂô®
echo "ÂêØÂä®Êñ∞ÂÆπÂô®..."
docker run -d \
  --name $CONTAINER_NAME \
  --restart unless-stopped \
  -p $PORT:3000 \
  -e NODE_ENV=production \
  -e DB_HOST=host.docker.internal \
  -e REDIS_HOST=host.docker.internal \
  --health-cmd="node healthcheck.js" \
  --health-interval=30s \
  --health-timeout=10s \
  --health-retries=3 \
  $IMAGE_NAME:latest

# Á≠âÂæÖÂÆπÂô®ÂêØÂä®
echo "Á≠âÂæÖÂÆπÂô®ÂêØÂä®..."
sleep 10

# Ê£ÄÊü•ÂÆπÂô®Áä∂ÊÄÅ
if docker ps | grep -q $CONTAINER_NAME; then
  echo "‚úÖ ÈÉ®ÁΩ≤ÊàêÂäüÔºÅ"
  docker logs --tail 20 $CONTAINER_NAME
else
  echo "‚ùå ÈÉ®ÁΩ≤Â§±Ë¥•ÔºÅ"
  docker logs $CONTAINER_NAME
  exit 1
fi

# Ê∏ÖÁêÜÊú™‰ΩøÁî®ÁöÑÈïúÂÉè
echo "Ê∏ÖÁêÜÊú™‰ΩøÁî®ÁöÑÈïúÂÉè..."
docker image prune -f

echo "ÈÉ®ÁΩ≤ÂÆåÊàêÔºÅ"
```

## üìä ÁõëÊéßÂíåÊó•Âøó

### 1. Êó•ÂøóÈÖçÁΩÆ

```javascript
// logger.js
const winston = require('winston');

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { 
    service: 'myapp',
    version: process.env.npm_package_version,
    hostname: require('os').hostname(),
    pid: process.pid
  },
  transports: [
    // ÊéßÂà∂Âè∞ËæìÂá∫ÔºàDocker ‰ºöÊçïËé∑Ôºâ
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    })
  ]
});

// Áîü‰∫ßÁéØÂ¢ÉÊ∑ªÂä†Êñá‰ª∂Êó•Âøó
if (process.env.NODE_ENV === 'production') {
  logger.add(new winston.transports.File({
    filename: '/app/logs/error.log',
    level: 'error',
    maxsize: 5242880, // 5MB
    maxFiles: 5
  }));
  
  logger.add(new winston.transports.File({
    filename: '/app/logs/combined.log',
    maxsize: 5242880, // 5MB
    maxFiles: 5
  }));
}

module.exports = logger;
```

### 2. ÁõëÊéßÈõÜÊàê

```yaml
# docker-compose.monitoring.yml
version: '3.8'

services:
  app:
    # ... Â∫îÁî®ÈÖçÁΩÆ
    labels:
      - "prometheus.io/scrape=true"
      - "prometheus.io/port=3000"
      - "prometheus.io/path=/metrics"

  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--web.enable-lifecycle'
    networks:
      - app-network

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3001:3000"
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana/datasources:/etc/grafana/provisioning/datasources
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    networks:
      - app-network

  node-exporter:
    image: prom/node-exporter:latest
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc)($$|/)'
    networks:
      - app-network

volumes:
  prometheus-data:
  grafana-data:
```

### 3. Prometheus ÈÖçÁΩÆ

```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node-app'
    static_configs:
      - targets: ['app:3000']
    metrics_path: '/metrics'
    scrape_interval: 5s

  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
```

## üîí ÂÆâÂÖ®ÊúÄ‰Ω≥ÂÆûË∑µ

### 1. ÂÆâÂÖ®ÁöÑ Dockerfile

```dockerfile
# ÂÆâÂÖ®‰ºòÂåñÁöÑ Dockerfile
FROM node:18-alpine AS base

# Êõ¥Êñ∞Á≥ªÁªüÂåÖ
RUN apk update && apk upgrade

# ÂÆâË£ÖÂÆâÂÖ®Êõ¥Êñ∞
RUN apk add --no-cache dumb-init

# ÂàõÂª∫Â∫îÁî®ÁõÆÂΩï
WORKDIR /app

# ÂàõÂª∫Èùû root Áî®Êà∑
RUN addgroup -g 1001 -S nodejs && \
    adduser -S -D -H -u 1001 -s /sbin/nologin nodejs

# ÊûÑÂª∫Èò∂ÊÆµ
FROM base AS builder

# Â§çÂà∂ package Êñá‰ª∂
COPY package*.json ./

# ÂÆâË£Ö‰æùËµñ
RUN npm ci --only=production && \
    npm cache clean --force

# Â§çÂà∂Â∫îÁî®‰ª£Á†Å
COPY . .

# ËøêË°åÂÆâÂÖ®Êâ´Êèè
RUN npm audit --audit-level moderate

# ÊúÄÁªàÈò∂ÊÆµ
FROM base AS production

# Â§çÂà∂Â∫îÁî®Êñá‰ª∂
COPY --from=builder --chown=nodejs:nodejs /app .

# ÁßªÈô§‰∏çÂøÖË¶ÅÁöÑÊñá‰ª∂
RUN rm -rf /tmp/* /var/cache/apk/* /root/.npm

# ËÆæÁΩÆÊñá‰ª∂ÊùÉÈôê
RUN chmod -R 755 /app && \
    chmod 644 /app/package*.json

# ÂàáÊç¢Âà∞Èùû root Áî®Êà∑
USER nodejs

# Êö¥Èú≤Á´ØÂè£
EXPOSE 3000

# ‰ΩøÁî® dumb-init
ENTRYPOINT ["dumb-init", "--"]

# ÂêØÂä®Â∫îÁî®
CMD ["node", "server.js"]
```

### 2. ÂÆâÂÖ®ÈÖçÁΩÆ

```yaml
# docker-compose.security.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
      - /app/logs:noexec,nosuid,size=50m
    ulimits:
      nproc: 65535
      nofile:
        soft: 65535
        hard: 65535
    restart: unless-stopped
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  app-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.20.0.0/16
```

## üìö ÊúÄ‰Ω≥ÂÆûË∑µÊÄªÁªì

1. **ÈïúÂÉè‰ºòÂåñ**Ôºö‰ΩøÁî®Â§öÈò∂ÊÆµÊûÑÂª∫ÔºåÈÄâÊã©ÂêàÈÄÇÁöÑÂü∫Á°ÄÈïúÂÉè
2. **ÂÆâÂÖ®ÊÄß**Ôºö‰ΩøÁî®Èùû root Áî®Êà∑ÔºåÊúÄÂ∞èÊùÉÈôêÂéüÂàô
3. **ÂÅ•Â∫∑Ê£ÄÊü•**ÔºöÂÆûÁé∞ÂÆåÊï¥ÁöÑÂÅ•Â∫∑Ê£ÄÊü•Êú∫Âà∂
4. **‰ºòÈõÖÂÖ≥Èó≠**ÔºöÊ≠£Á°ÆÂ§ÑÁêÜ‰ø°Âè∑Ôºå‰ºòÈõÖÂÖ≥Èó≠Â∫îÁî®
5. **Êó•ÂøóÁÆ°ÁêÜ**ÔºöÁªìÊûÑÂåñÊó•ÂøóÔºåÁªü‰∏ÄÊó•ÂøóÊ†ºÂºè
6. **ÁõëÊéßÈõÜÊàê**ÔºöÈõÜÊàê Prometheus Âíå Grafana
7. **ÁéØÂ¢ÉÁÆ°ÁêÜ**Ôºö‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáèÁÆ°ÁêÜÈÖçÁΩÆ
8. **CI/CD**ÔºöËá™Âä®ÂåñÊûÑÂª∫„ÄÅÊµãËØïÂíåÈÉ®ÁΩ≤ÊµÅÁ®ã

ÈÄöËøáÊéåÊè°Ëøô‰∫õÂÆπÂô®ÂåñÈÉ®ÁΩ≤ÊäÄÊúØÔºåÊÇ®Â∞ÜËÉΩÂ§üÊûÑÂª∫ÂÆâÂÖ®„ÄÅÂèØÈù†„ÄÅÂèØÊâ©Â±ïÁöÑÂÆπÂô®Âåñ Node.js Â∫îÁî®Á®ãÂ∫è„ÄÇ
